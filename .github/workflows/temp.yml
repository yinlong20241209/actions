name: "Temp for test"

on:
  workflow_dispatch:

jobs:
  echo1:
    name: "wx web hook1"
    runs-on: ubuntu-22.04
    permissions:
      contents: write
    timeout-minutes: 30

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: 配置 Git 用户
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: 修改文件（示例）
        run: |
          date > LAST_BUILD.txt
          echo "v1.0.$GITHUB_RUN_NUMBER" > VERSION.txt
      
      - name: 提交并推送
        run: |
          git add .
          # 检查是否有变更，避免空提交
          if git diff --cached --quiet; then
            echo "无变更，跳过提交"
            exit 0
          fi
          git commit -m "chore: auto-update files [skip ci]"
          git push
      - name: pwd
        run: pwd
      - name: list
        run: ls -la
      - name: Checkout
        uses: actions/checkout@v6.0.2
      - name: list
        run: ls -la
      - name: list
        uses: ./.github/workflows/utils/list-files
      - name: use repo file
        run: |
          chmod +x ./scripts/test.sh
          ./scripts/test.sh
          touch ./scripts/new.sh
      - name: Upload to GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            ./scripts/*

      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v6.0.0
        with:
          path: ./scripts/test.sh

      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v6.0.0
        with:
          name: all-sh
          path: ./scripts/*.sh

      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v6.0.0
        with:
          name: should-not-found
          path: ./scripts/*.s

      - name: Set message
        id: msg
        run: echo "MESSAGE=hello1 from build $GITHUB_RUN_NUMBER" >> "$GITHUB_ENV"
        
      - name: Send WeChat notification
        env:
          WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}
          MESSAGE: ${{ env.MESSAGE }}
        run: |
          curl -fsSL -X POST "$WEBHOOK_URL" \
            -H 'Content-Type: application/json' \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"$MESSAGE\"
              }
            }"

  echo2:
    name: "wx web hook2"
    runs-on: ubuntu-22.04
    timeout-minutes: 300

    steps:
      - name: Set message
        id: msg
        run: echo "MESSAGE=hello2 from build $GITHUB_RUN_NUMBER" >> "$GITHUB_ENV"
        
      - name: Send WeChat notification
        env:
          WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}
          MESSAGE: ${{ env.MESSAGE }}
        run: |
          curl -fsSL -X POST "$WEBHOOK_URL" \
            -H 'Content-Type: application/json' \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"$MESSAGE\"
              }
            }"

  echo3:
    name: "wx web hook3"
    needs: [echo1,echo2]
    runs-on: ubuntu-22.04
    timeout-minutes: 300

    steps:
      - name: Set message
        id: msg
        run: echo "MESSAGE=hello3 from build $GITHUB_RUN_NUMBER" >> "$GITHUB_ENV"
        
      - name: Send WeChat notification
        env:
          WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}
          MESSAGE: ${{ env.MESSAGE }}
        run: |
          curl -fsSL -X POST "$WEBHOOK_URL" \
            -H 'Content-Type: application/json' \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"$MESSAGE\"
              }
            }"

  echo4:
    name: "wx web hook4"
    needs: echo3
    runs-on: ubuntu-22.04
    timeout-minutes: 300

    steps:
      - name: Set message
        id: msg
        run: echo "MESSAGE=hello4 from build $GITHUB_RUN_NUMBER" >> "$GITHUB_ENV"
        
      - name: Send WeChat notification
        env:
          WEBHOOK_URL: ${{ secrets.WECHAT_WEBHOOK_URL }}
          MESSAGE: ${{ env.MESSAGE }}
        run: |
          curl -fsSL -X POST "$WEBHOOK_URL" \
            -H 'Content-Type: application/json' \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"$MESSAGE\"
              }
            }"

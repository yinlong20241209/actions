name: "Simple Armbian Build"

on:
  workflow_dispatch:  # 仅手动触发

jobs:
  build:
    name: "Build Armbian"
    runs-on: ubuntu-22.04
    timeout-minutes: 300

    steps:
      # 1. 清理磁盘空间
      - name: "Cleanup disk space"
        run: |
          sudo apt-get clean
          sudo rm -rf /usr/local/lib/android /opt/ghc /usr/share/dotnet
          sudo apt install qemu-user-static qemu-user binfmt-support
          df -h

      # 2. 克隆构建系统
      - name: "Clone Armbian build"
        run: |
          git clone https://github.com/armbian/build.git --depth=1

      # 3. 执行构建（所有参数硬编码）
      - name: "Run compile.sh"
        run: |
          cd build
          
          ./compile.sh \
            BOARD=hinlink-h28k \
            BRANCH=vendor \
            RELEASE=trixie \
            BUILD_MINIMAL=yes \
            BUILD_DESKTOP=no \
            KERNEL_CONFIGURE="no" \

      # 4. 上传镜像文件
      - name: "Upload image"
        uses: actions/upload-artifact@v4
        with:
          path: build/output/images/*
          if-no-files-found: error
          retention-days: 5
